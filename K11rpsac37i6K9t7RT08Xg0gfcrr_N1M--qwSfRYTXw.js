function fuzzysearch(n,t){var r=t.length,u=n.length,i,f,e;if(u>r)return!1;if(u===r)return n===t;n:for(i=0,f=0;i<u;i++){for(e=n.charCodeAt(i);f<r;)if(t.charCodeAt(f++)===e)continue n;return!1}return!0}function undercore(n){return n?n.replaceAll(/ +/g,"_").toLowerCase().replaceAll(/[^a-z0-9A-Z_]+/g,""):null}function isElementInViewport(n){const t=n.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}class CustomToast extends HTMLElement{static get observedAttributes(){return["message"]}constructor(){super();this.root=this.attachShadow({mode:"open"});const r=document.createElement("style");r.textContent=CustomToast.getStyle();this.root.appendChild(r);const n=document.createElement("DIV");n.setAttribute("class","c3-toast");const t=document.createElement("DIV");t.setAttribute("class","notification-action-renderer");const i=document.createElement("DIV");i.setAttribute("class","notification-action-response-text");t.appendChild(i);n.appendChild(t);this.root.appendChild(n);this.c3Toast=n;this.notificationActionResponseText=i;this.messages=[];this.timer=0}connectedCallback(){}disconnectedCallback(){}showMessage(){if(this.messages.length&&!this.showing){const n=this.messages.shift();this.notificationActionResponseText.textContent=n;this.c3Toast.setAttribute("dir","in");this.showing=!0;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(()=>{this.c3Toast.setAttribute("dir","out"),setTimeout(()=>{this.showing=!1,this.showMessage()},195)},3e3)}}attributeChangedCallback(n,t,i){n==="message"&&(this.messages.push(i),this.showMessage())}adoptedCallback(){}static getTemplate(n){return`
        ${CustomToast.getStyle()}
        <div>
            ${n}
        </div>
        `}static getStyle(){return`
        .c3-toast[dir="in"] {
            transition: margin 225ms cubic-bezier(0.0, 0.0, 0.2, 1);
            margin-bottom: 0;
        }
        
        .c3-toast[dir="out"] {
            transition: margin 195ms cubic-bezier(0.4, 0.0, 1, 1);
        }
        
        .c3-toast {
            display: block;
            position: fixed;
            z-index: 4;
            left: 0;
            right: 0;
            bottom: 0;
            box-sizing: border-box;
            padding: 14px 24px;
            font-size: 1.4rem;
            color: #ffffff;
            background: hsl(0, 0%, 20%);
            will-change: transform;
            margin-bottom: -100%;
        }
        
        .notification-action-renderer {
            display: flex;
            align-items: center;
        }
        
        .notification-action-response-text {
            flex-grow: 1;
            padding-right: 1rem;
            font-size:14px;
        }
        
        `}}customElements.define("custom-toast",CustomToast),function(){function r(){f.removeAttribute("data-mode");t.setAttribute("hidden","");n.setAttribute("hidden","");o.setAttribute("hidden","");i.removeAttribute("hidden");e.removeAttribute("hidden")}const u=document.querySelector(".topbar-header-content > button:nth-child(2)"),c=document.querySelector(".topbar-header-content > button:nth-child(3)"),f=document.querySelector(".topbar-header"),n=document.querySelector(".topbar-back-arrow"),i=document.querySelector(".topbar-header-endpoint"),e=document.querySelector(".topbar-header-content"),o=document.querySelector(".searchbox"),t=document.querySelector("c3-overlay"),s=document.querySelector(".menu-container"),h=document.querySelector(".menu-container c3-overlay");c.addEventListener("click",n=>{n.stopPropagation(),s.removeAttribute("hidden")});h&&h.addEventListener("click",n=>{n.stopPropagation(),s.setAttribute("hidden","")});t&&t.addEventListener("click",n=>{n.stopPropagation(),r()});u&&u.addEventListener("click",r=>{r.stopPropagation(),f.setAttribute("data-mode","searching"),i.setAttribute("hidden",""),e.setAttribute("hidden",""),t.removeAttribute("hidden"),n.removeAttribute("hidden"),o.removeAttribute("hidden")});n&&n.addEventListener("click",n=>{n.stopPropagation(),r()});i.addEventListener("click",n=>{n.stopPropagation(),window.location.href="/"});const l=document.querySelector(".topbar-title");l.addEventListener("click",n=>{n.stopPropagation(),window.location.href="/"});window.close=r}(),function(){function r(){const n=document.querySelector(".searchbox-form"),i=document.querySelector(".searchbox-input");n.addEventListener("submit",async n=>{n.preventDefault();const r=i.value.trim();if(r){t||(t=await e());const f=t.filter(n=>fuzzysearch(r,n.ChineseTitle)||fuzzysearch(r,n.Title));if(window.close(),!f||!f.length){s.setAttribute("message",`没有找到与 "${r}" 相关的结果`);return}document.querySelectorAll(".rich-item-renderer").forEach(n=>n.remove());const h=document.createDocumentFragment();f.forEach(n=>{h.appendChild(u(n))});const c=document.createElement("div");c.appendChild(h);o.insertAdjacentElement("afterend",c)}})}function u(t){let c=`${undercore(t.Title)}_${t.UniqueId}`;const l=document.createElement("DIV");l.setAttribute("class","rich-item-renderer");const e=document.createElement("DIV");e.setAttribute("class","large-media-item");const a=document.createElement("A");a.setAttribute("href",`videos/${c}`);const o=document.createElement("DIV");o.setAttribute("class","video-thumbnail-container-large");const d=document.createElement("DIV");d.setAttribute("class","cover video-thumbnail-bg");o.appendChild(d);const r=document.createElement("IMG");r.setAttribute("class","cover");r.setAttribute("alt",t.Title);r.setAttribute("data-src",`//static.lucidu.cn/images/${c}.jpg`);n.observe(r);o.appendChild(r);a.appendChild(o);e.appendChild(a);const s=document.createElement("DIV");s.setAttribute("class","details");const v=document.createElement("DIV");v.setAttribute("class","large-media-channel");const y=document.createElement("DIV");y.setAttribute("class","profile-icon");const u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.style.width="24px";u.setAttribute("viewBox","0 0 24 24");u.style.width="24px";const g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d","M17.016 10.5l3.984-3.984v10.969l-3.984-3.984v3.516q0 0.422-0.305 0.703t-0.727 0.281h-12q-0.422 0-0.703-0.281t-0.281-0.703v-10.031q0-0.422 0.281-0.703t0.703-0.281h12q0.422 0 0.727 0.281t0.305 0.703v3.516z");u.appendChild(g);y.appendChild(u);v.appendChild(y);s.appendChild(v);const h=document.createElement("DIV");h.setAttribute("class","large-media-item-info");const p=document.createElement("DIV");p.setAttribute("class","large-media-item-metadata");const w=document.createElement("A");w.setAttribute("href",`videos/${c}`);const b=document.createElement("H3");b.setAttribute("class","large-media-item-headline");b.appendChild(document.createTextNode(t.ChineseTitle));w.appendChild(b);p.appendChild(w);h.appendChild(p);const k=document.createElement("DIV");k.setAttribute("class","large-media-item-menu");const f=document.createElement("BUTTON");f.setAttribute("class","icon-button ");f.setAttribute("aria-label","操作菜单");f.setAttribute("aria-haspopup","true");const nt=document.createElement("C3-ICON"),i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg");i.setAttribute("enable-background","new 0 0 24 24");i.setAttribute("height","24");i.setAttribute("viewBox","0 0 24 24");i.setAttribute("width","24");const tt=document.createElementNS("http://www.w3.org/2000/svg","path");return tt.setAttribute("d","M12,16.5c0.83,0,1.5,0.67,1.5,1.5s-0.67,1.5-1.5,1.5s-1.5-0.67-1.5-1.5S11.17,16.5,12,16.5z M10.5,12 c0,0.83,0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5s-0.67-1.5-1.5-1.5S10.5,11.17,10.5,12z M10.5,6c0,0.83,0.67,1.5,1.5,1.5 s1.5-0.67,1.5-1.5S12.83,4.5,12,4.5S10.5,5.17,10.5,6z"),i.appendChild(tt),nt.appendChild(i),f.appendChild(nt),k.appendChild(f),h.appendChild(k),s.appendChild(h),e.appendChild(s),l.appendChild(e),l}function f(t){n=new IntersectionObserver(t=>{Array.prototype.forEach.call(t,function(t){t.isIntersecting&&(n.unobserve(t.target),t.target.dataset.src&&(t.target.src=t.target.dataset.src,t.target.removeAttribute("data-src")))})});t.forEach(t=>{n.observe(t)})}async function e(){const n=await fetch("../search_data.json");if(n.ok)return await n.json();throw new Error(`${n.statusText}`);}const i=document.querySelectorAll("img.cover");let t,n;const o=document.querySelector(".topbar"),s=document.querySelector("#toast");addEventListener("DOMContentLoaded",()=>{i.forEach(n=>{n.dataset.src&&isElementInViewport(n)&&(n.src=n.dataset.src,n.removeAttribute("data-src"))})},!1);r();f(i)}()